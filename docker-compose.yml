services:
  selenium:
    image: selenium/standalone-chrome:latest
    shm_size: 512m
    ports:
    - "4444:4444"   # WebDriver
    - "7900:7900"   # ðŸ‘ˆ noVNC (el navegador visible)

  dagster:
    build:
      context: .
      dockerfile: Dockerfile_dagster
    environment:
      - DAGSTER_HOME=/opt/dagster/dagster_home
      - SELENIUM_REMOTE_URL=http://selenium:4444/wd/hub
    volumes:
      - /home/ubuntu/work/repo_dagster:/opt/dagster/app
      - ./dagster_home:/opt/dagster/dagster_home
      - ./data:/opt/dagster/data
    ports:
      - "8080:3000"
    depends_on:
      - selenium
    command: >
      dagster-webserver -h 0.0.0.0 -p 3000 -f /opt/dagster/app/__init__.py
